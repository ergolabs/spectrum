Chain selection consists of two steps: filtering out valid chains, and second compare them\
using the Genesis rule~\cite{Badertscher2018}.

\bigbreak
\noindent
\phantomsection
\textbf{Maximum Stake Rule}.\label{apndx:max-stake-rule}
Rule to resolve conflicts that arise after applying the Genesis rule.
\begin{algo}
    \caption{${\textsf{MaxStakeChain}(\mathcal{C}_i}, \mathcal{C}_{i'})$}
    \begin{algorithmic}[1]
        \If {$\sum \{B_k\textsf{.get(}s\textsf{)}, \forall B_k \in  \mathcal{C}_i\} > \sum \{B_k\textsf{.get(}s\textsf{)}, \forall B_k \in  \mathcal{C}_{i'}\}$}

            \noindent
            \lstinline|// Used above value s is the stake of the leader|

            \noindent
            \lstinline|// who produced the block B_k.|
            \State Set ${\mathcal{C}_{\max} \leftarrow \mathcal{C}_{i}}$.
        \Else
            \noindent
            \lstinline|  // It is assumed that the input chains are the same size.|
            \State Set ${\mathcal{C}_{\max} \leftarrow \mathcal{C}_{i'}}$.
        \EndIf
        \State \Return ${\mathcal{C}_{\max}}$
    \end{algorithmic}\label{alg:max-stake-rule}
\end{algo}

\bigbreak
\bigbreak
\noindent
\phantomsection
\textbf{Maximum Valid Rule}.\label{apndx:max-valid-rule}
The Genesis chain selection rule:
\begin{algo}
    \caption{${\textsf{MaxValidChain}(\mathcal{C}_{\text{loc}}, C_{\text{set}} = \{\mathcal{C}_i\}_{i=1}^N, K_{\text{f}}, K_{\text{g}})}$}
    \begin{algorithmic}[1]
        \noindent
        \lstinline|// C_loc is the local chain of the validator.|
        \noindent
        \lstinline|// Set local chain as initially maximum valid chain:|
        \State Set ${\mathcal{C}_{\max} \leftarrow \mathcal{C}_{\text{loc}}}$.
        \For {${i = 1 \dots N}$}
            \If {$\mathcal{C}_i$ forks from $\mathcal{C}_{\max}$ at most $K_{\text{f}}$ blocks}
                \If {$|\mathcal{C}_i| > |\mathcal{C}_{\max}|$}
                    \State Set ${\mathcal{C}_{\max} \leftarrow \mathcal{C}_{i}}$.
                \ElsIf
                        {$|\mathcal{C}_i| == |\mathcal{C}_{\max}|$}
                    \State Set ${\mathcal{C}_{\max} \leftarrow \textsf{MaxStakeChain}(\mathcal{C}_{i}, \mathcal{C}_{\max})}$.

                \EndIf
            \Else

                \State Let ${j  \leftarrow \max \{j' \geq 0 \ |\  \mathcal{C}_{\max} \text{ and } \mathcal{C}_{i} \
                \text{have the same block in } sl_{j'}\}}$.
                \If {$|\mathcal{C}_i[j: j + K_{\text{g}}]| > |\mathcal{C}_{\max}[j: j + K_{\text{g}}]|$}
                    \State Set ${\mathcal{C}_{\max} \leftarrow \mathcal{C}_{i}}$.
                \ElsIf
                        {$|\mathcal{C}_i| = |\mathcal{C}_{\max}|$}
                    \State Set ${\mathcal{C}_{\max} \leftarrow \textsf{MaxStakeChain}(\mathcal{C}_{i}, \mathcal{C}_{\max})}$.
                \EndIf
            \EndIf

        \EndFor
        \State \Return ${\mathcal{C}_{\max}}$
    \end{algorithmic}\label{alg:max-valid-rule}
\end{algo}

\bigbreak
\bigbreak
\noindent
\phantomsection
\textbf{Chain Selection Protocol}.\label{apndx:max-selection-protocol}
The main chain selection protocol is as follows:
\begin{protocol}
    \caption{$\textsf{SelectChain}(P, \text{sid}, R, K_{\text{f}}, K_{\text{g}}, \mathcal{C}_{\text{loc}}, \mathcal{N}_0)$}
    \begin{algorithmic}[1]
        \State Initialize $\mathcal{N}_{\text{valid}} \leftarrow \emptyset$.

        \noindent
        \lstinline|// Filter all valid chains:|
        \For {$\mathcal{C} \in \mathcal{N}_0$}
            \State Set $\textsf{is\_valid\_chain} \leftarrow IsValidChain(P, \text{sid}, R, \mathcal{C}_{\text{loc}})$.
            \If {$\textsf{is\_valid\_chain} = \textsf{true}$}
                \State Update $\mathcal{N}_{\text{valid}} \leftarrow \mathcal{N}_{\text{valid}} \cup \mathcal{C}$.
            \EndIf
        \EndFor

        \noindent
        \lstinline|// Set local chain as maximum valid chain:|
        \State Set $\mathcal{C}_{\text{loc}} \leftarrow \textsf{MaxValidChain}(\mathcal{C}_{\text{loc}}, \mathcal{N}_0, K_{\text{f}}, K_{\text{g}})$.

    \end{algorithmic}\label{alg:max-selection-protocol}
\end{protocol}
